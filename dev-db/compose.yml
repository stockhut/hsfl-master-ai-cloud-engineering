services:
  db:
    image: "postgres:16"
    ports:
      - "5432:5432"
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: password
    healthcheck:
      test: [ "CMD-SHELL", "pg_isready -U postgres"]
      interval: "1s"
  auth:
    image: ghcr.io/stockhut/hsfl-master-ai-cloud-engineering/auth:test
    ports:
      - "8080:8080" # http
      - "3001:3001" # grpc
    environment:
      JWT_PRIVATE_KEY: /keys/jwt_private_key.key
      PG_CONN_STRING: postgres://postgres:password@db:5432
    volumes:
      - ./:/keys
    depends_on:
      db:
        condition: service_healthy
  recipe:
    image: ghcr.io/stockhut/hsfl-master-ai-cloud-engineering/recipe:test
    ports:
      - "8081:8081" # http
    environment:
      JWT_PUBLIC_KEY: /keys/jwt_public_key.key
      PG_CONN_STRING: postgres://postgres:password@db:5432
      AUTH_RPC_TARGET: auth:3001
    volumes:
      - ./:/keys
    depends_on:
      db:
        condition: service_healthy

      
